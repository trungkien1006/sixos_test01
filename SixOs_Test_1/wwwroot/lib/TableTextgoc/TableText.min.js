const TableText=function(){const t=t=>"string"==typeof t&&t.indexOf("<")>-1,e=(t,e)=>{for(const[n,a]of Object.entries(e))t.style[n]=a},n=(t,e)=>{if(!e.includes("."))return t[e];const n=e.split(".");let a=t;for(const t of n){if(!a||!(t in a))return;a=a[t]}return a},a=t=>{if(!t)return"";const e=new Date(t);return`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${e.getFullYear()}`},o=t=>{if(!t)return"";const e=new Date(t);return`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${e.getFullYear()} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},i=t=>t?Number.isInteger(t)?t.toLocaleString("en-US"):t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"",s=t=>{const n=[];function a(t){return t.reduce(((t,e)=>"string"==typeof e?t+1:"object"==typeof e?e.children&&e.children.length>0?t+a(e.children):t+1:t),0)}!function t(e,o){n[o]||(n[o]=[]),e.forEach((e=>{if("string"==typeof e)n[o].push({content:e,rowspan:1,colspan:1,main:e.main,styles:e.styles});else if("object"==typeof e)if(e.children&&e.children.length>0){const i=a(e.children);let s={content:e.content?e.content():e.title,rowspan:1,colspan:i,main:e.main,styles:e.styles,parent:!0};e.class&&(s.class=e.class),e.first&&(s.first=e.first),e.last&&(s.last=e.last),n[o].push(s),t(e.children,o+1)}else{let t={content:e.content?e.content():e.title,rowspan:1,colspan:1,main:e.main,styles:e.styles};e.class&&(t.class=e.class),e.first&&(t.first=e.first),e.last&&(t.last=e.last),n[o].push(t)}}))}(t,0);const o=function t(e){return e.reduce(((e,n)=>"string"==typeof n?Math.max(e,1):"object"==typeof n&&n.children?Math.max(e,1+t(n.children)):e),0)}(t);n.forEach(((t,e)=>{t.forEach((t=>{1!==t.rowspan||1!==t.colspan||t.parent||(t.rowspan=o-e)}))}));const i=document.createDocumentFragment();return n.forEach((t=>{const n=document.createElement("tr");n.classList.add("text-center"),t.forEach((t=>{const a=document.createElement("th");t.class&&(a.className=t.class),t.first&&a.classList.add("first-th-column"),t.last&&a.classList.add("last-th-column"),t.main&&a.classList.add("col-tabletext-main"),a.rowSpan=t.rowspan,a.colSpan=t.colspan,a.innerHTML=t.content,t.styles&&e(a,t.styles),n.appendChild(a)})),i.appendChild(n)})),i},r=t=>{const e={name:"stt",class:"text-center"};Array.isArray(t)&&(t.unshift(e),t.forEach((t=>{t.columnSetting&&r(t.columnSetting)})))},l=(t,e)=>{const n=document.createElement((t.dropdownBtn,"div"));if(n.classList.add(t.dropdownBtn?"dropdown":"btn-group"),t.dropdownBtn){n.innerHTML='<a href="#" class="link-secondary" data-bs-toggle="dropdown" aria-expanded="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M4 6l16 0"></path><path d="M4 12l16 0"></path><path d="M4 18l16 0"></path></svg></a>';const o=document.createElement("div");o.className="dropdown-menu dropdown-menu-end",a(t.listBtn,o,e,!0),n.appendChild(o)}else a(t.listBtn,n,e,!1);function a(t,e,n,a){t.forEach((t=>{const o=document.createElement(t.content?"div":"button");t.content?(o.innerHTML=t.content(n),t.onClick&&(o.onclick=e=>{e.stopPropagation(),t.onClick(n)})):(o.innerHTML=function(t){const e={edit:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-edit" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"></path><path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"></path><path d="M16 5l3 3"></path></svg>',pdf:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-printer"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M17 17h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-14a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h2"></path><path d="M17 9v-4a2 2 0 0 0 -2 -2h-6a2 2 0 0 0 -2 2v4"></path><path d="M7 13m0 2a2 2 0 0 1 2 -2h6a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-6a2 2 0 0 1 -2 -2z"></path></svg>',delete:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M4 7l16 0"></path><path d="M10 11l0 6"></path><path d="M14 11l0 6"></path><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path></svg>',watch:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-eye"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"></path><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6"></path></svg>',history:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-history"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 8l0 4l2 2"></path><path d="M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5"></path></svg>',save:'<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-device-floppy"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2" /><path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M14 4l0 4l-6 0l0 -4" /></svg>'};if(t.edit)return e.edit;if(t.pdf)return e.pdf;if(t.delete)return e.delete;if(t.watch)return e.watch;if(t.history)return e.history;if(t.save)return e.save}(t),o.className=function(t,e){const n=e?"dropdown-item":"btn btn-icon",a={edit:e?"text-azure":"bg-azure-lt",pdf:e?"text-success":"bg-success-lt",delete:e?"text-danger":"bg-danger-lt",watch:e?"text-warning":"bg-warning-lt",history:e?"text-info":"bg-info-lt",save:e?"text-azure":"bg-azure-lt"};let o="";t.edit&&(o=a.edit);t.pdf&&(o=a.pdf);t.delete&&(o=a.delete);t.watch&&(o=a.watch);t.history&&(o=a.history);t.save&&(o=a.save);return`${n} ${o} ${t.class||""}`}(t,a),o.title=t.title||"",t.title&&a&&o.appendChild(document.createTextNode(t.title)),t.onClick&&(o.onclick=e=>{e.stopPropagation(),t.onClick(n)})),e.appendChild(o)}))}return n};return class{constructor(e,n){var a=(e=>{if(e.jquery)return e[0];if(e instanceof HTMLElement)return e;if(t(e)){var n=document.createElement("template");return n.innerHTML=e.trim(),n.content.firstChild}return document.querySelector(e)})(e);if(!a)throw new Error("Không tìm thấy bảng "+e);if(a.querySelector("table")&&a.querySelector("table").tabletext)throw new Error("Table "+e+" đã được config!");a.innerHTML="",a.classList.add("card");const o=document.createElement("div");o.className="table-responsive",n.vhClass&&o.classList.add(n.vhClass),a.appendChild(o);const i=document.createElement("table");if(i.id=a.id+"-table",o.appendChild(i),a.appendChild(o),a.tabletext=this,this.divTable=a,this.settings=n,this.table=i,this.thead=i.querySelector("thead"),this.tbody=i.querySelector("tbody"),this.tfoot=i.querySelector("tfoot"),this.datas=[],this.headerSetting=[],this.columnSetting=[],this.rowSetting=[],this.serial=!1,this.pagination=null,this.onPaginationChange=null,this.sumColumns={},0==this.table.classList.length&&(this.table.classList="table table-vcenter table-bordered table-hover table-nowrap "+(n.tableInput?"table-input":"table-text")),this.table.classList.add("table-text-js"),n.headerSetting&&n.headerSetting.length>0&&(this.headerSetting=n.headerSetting),n.columnSetting&&n.columnSetting.length>0){this.columnSetting=n.columnSetting;const t=e=>{e.forEach((e=>{"object"==typeof e&&e.sumName&&(this.sumColumns[e.sumName]=0),"object"==typeof e&&e.columnSetting&&e.columnSetting.length>0&&t(e.columnSetting)}))};t(this.columnSetting)}if(n.rowSetting&&(this.rowSetting=this.settings.rowSetting),n.serial&&(this.serial=this.settings.serial,this.headerSetting.unshift("STT"),r(this.columnSetting)),this.thead||(this.thead=document.createElement("thead"),this.thead.id=this.table.id+"-thead",this.table.appendChild(this.thead),this.headerSetting&&this.headerSetting.length>0&&this.renderHeader()),this.tbody||(this.tbody=document.createElement("tbody"),this.tbody.id=this.table.id+"-tbody",this.table.appendChild(this.tbody)),n.afterRender&&(this.afterRender=n.afterRender),n.beforeRender&&(this.beforeRender=n.beforeRender),n.datas&&n.datas.length>0&&(this.datas=this.settings.datas,this.renderView()),n.bottomDiv){const t=document.createElement("div");t.classList.add("p-2");const e=n.bottomDiv(this.sumColumns);"string"==typeof e?t.innerHTML=e:e instanceof HTMLElement&&t.appendChild(e),a.appendChild(t),this.bottomDiv=t,this.bottomDivFunction=n.bottomDiv}n.onPaginationChange&&(this.onPaginationChange=n.onPaginationChange),n.pagination&&this.renderPagination()}renderHeader(){let t=s(this.headerSetting);this.thead.appendChild(t)}render(t){this.tbody.innerHTML="";const s=(t,r,d,c=null)=>{this.serial&&(t.stt=c?c+"."+r:r);let h=document.createElement("tr");if(this.rowSetting.class&&("string"==typeof this.rowSetting.class?h.classList.add(this.rowSetting.class):"function"==typeof this.rowSetting.class&&(h.className=this.rowSetting.class(t))),this.rowSetting.data)for(let e in this.rowSetting.data)this.rowSetting.data[e].includes(".")?h.dataset[e]=n(t,this.rowSetting.data[e]):h.dataset[e]=void 0!==t[this.rowSetting.data[e]]?t[this.rowSetting.data[e]]:"";this.rowSetting.onClick&&(h.onclick=()=>this.rowSetting.onClick(t));let p=null,u=null,g=!1,m=!1;d.forEach(((s,r)=>{if(s.columnSetting&&s.columnSetting.length>0)p=s.columnSetting,u=t[s.name];else{const r=document.createElement("td");if("string"==typeof s&&s.length>0||"object"==typeof s&&s.name||s.data){let e=s.data?s.data(t):n(t,"string"==typeof s?s:s.name);const l="boolean"==typeof e;if(s.sumName&&(this.sumColumns[s.sumName]+=l&&e?1:e),s.format?e=s.format(e):s.date?e=a(e):s.dateShort?e=(t=>{if(!t)return"";const e=new Date(t);return`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getFullYear()).slice(-2)}`})(e):s.datetime?e=o(e):s.datetimeShort?e=(t=>{if(!t)return"";const e=new Date(t);return`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getFullYear()).slice(-2)} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`})(e):s.decimal&&(e=i(e)),s.date||s.datetime||s.center||s.dateShort||s.datetimeShort||l?r.classList.add("text-center"):(s.decimal||s.end)&&r.classList.add("text-end"),s.maxWidth){const t=document.createElement("p");t.className="text-truncate overflow-hidden mb-0",t.style.maxWidth=s.maxWidth+"px",t.textContent=e,t.title=e,r.appendChild(t)}else r.innerHTML=e}else s.content?(r.innerHTML=s.content(t),r.data=t):s.btnGroup?(r.classList.add("text-center"),r.appendChild(l(s.btnGroup,t))):r.innerHTML="";s.first?r.classList.add("first-td-column"):s.last&&r.classList.add("last-td-column"),s.class&&(r.className+=" "+s.class),s.main&&(m||(m=!0,this.table.classList.add("table-text-mobile")),r.classList.add("col-tabletext-main"),g||(r.classList.add("col-tabletext-main-first"),g=!0,r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-right col-tabletext-main-icon"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 6l6 6l-6 6" /></svg>'+r.textContent,r.querySelector(".col-tabletext-main-icon").onclick=s=>{s.stopPropagation();const r=s.target;document.querySelectorAll(".div-tabletext-show-detail-parent").forEach((t=>t.remove())),document.querySelectorAll(".col-tabletext-main-icon").forEach((t=>{t!=r&&(t.style.transform="")}));const d=((t,s,r,d)=>{let c=[];!function t(e){e.forEach((e=>{"string"==typeof e?c.push(e):"object"==typeof e&&(e.children&&e.children.length>0?t(e.children):c.push(e.title))}))}(r);const h=document.createElement("div");h.className="div-tabletext-show-detail-parent",h.style.position="absolute",h.style.top=`${t.bottom}px`,h.style.left=`${t.left}px`;const p=document.createElement("div");p.className="dropdown-menu-arrow div-tabletext-show-detail d-block p-2",p.style.width="90vw";const u=document.createElement("table");return u.className="table table-vcenter table-bordered",d.forEach(((t,r)=>{const d=document.createElement("tr"),h=document.createElement("th");h.textContent=c[r],d.appendChild(h);const p=document.createElement("td");t.name?t.name.includes(".")?data=n(s,t.name):data=void 0!==s[t.name]?s[t.name]:"":data=void 0!==s[t]?s[t]:"",t.content?p.innerHTML=t.content(s):t.btnGroup?(p.classList.add("text-center"),t.btnGroup.dropdownBtn=!1,p.appendChild(l(t.btnGroup,s))):(t.format?data=t.format(data):t.date?data=a(data):t.datetime?data=o(data):t.decimal&&(data=i(data)),t.date||t.datetime||t.center?p.classList.add("text-center"):(t.decimal||t.end)&&p.classList.add("text-end"),p.textContent=data),t.first?p.classList.add("first-td-column"):t.last&&p.classList.add("last-td-column"),t.class&&(p.className+=" "+t.class),t.styles&&e(p,t.styles),t.colspan&&(p.colSpan=t.colspan),t.rowspan&&(p.rowSpan=t.rowspan),d.appendChild(p),u.appendChild(d)})),p.appendChild(u),h.appendChild(p),h})(h.getBoundingClientRect(),t,this.headerSetting,this.columnSetting);"rotate(90deg)"===r.style.transform?r.style.transform="":(r.style.transform="rotate(90deg)",document.body.appendChild(d),setTimeout((()=>{d.querySelector(".div-tabletext-show-detail").classList.add("fade-in-top")}),10),document.body.onclick=t=>{d.contains(t.target)||(d.remove(),r.style.transform="",document.body.onclick=null)})})),s.styles&&e(r,s.styles),s.colspan&&(r.colSpan=s.colspan),s.rowspan&&(r.rowSpan=s.rowspan),s.hide||h.appendChild(r)}})),t.$row=h,this.tbody.appendChild(h),this.rowSetting.afterRowAppend&&this.rowSetting.afterRowAppend(h,t),p&&u&&(h.classList.add(c?"parent-row_"+c:"parent-row"),u.forEach(((t,e)=>{s(t,e+1,p,c?c+"."+r:r,!0)})))};t.forEach(((t,e)=>{s(t,e+1,this.columnSetting)}))}renderPagination(){const t=document.createElement("div");t.className="tabletext-pagination row justify-content-between px-2";const e=document.createElement("div"),n=document.createElement("div");e.className="col-auto",n.className="col-auto",e.innerHTML='<div class="row pt-1"><div class="col-auto"><select class="form-select"><option value="50" selected="">50</option><option value="100">100</option><option value="200">200</option><option value="0">Tất cả</option></select></div><div class="col-auto px-0 d-none parent-row-record"><label class="col-form-label"><span class="row-record"></span>/<span class="total-record"></span></label></div></div>',t.appendChild(e);const a=e.querySelector("select");n.innerHTML='<ul class="pagination m-2 justify-content-end"><li class="page-item disabled first"><button class="page-link"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M11 7l-5 5l5 5"></path><path d="M17 7l-5 5l5 5"></path></svg></button></li><li class="page-item disabled before"><button class="page-link" tabindex="-1" aria-disabled="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M15 6l-6 6l6 6"></path></svg></button></li><li class="page-item d-none"><button class="page-link"></button></li><li class="page-item active"><button class="page-link">1</button></li><li class="page-item d-none"><button class="page-link"></button></li><li class="page-item disabled after"><button class="page-link">\x3c!-- Download SVG icon from http://tabler-icons.io/i/chevron-right --\x3e<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 6l6 6l-6 6"></path></svg></button></li><li class="page-item disabled last"><button class="page-link"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7l5 5l-5 5"></path><path d="M13 7l5 5l-5 5"></path></svg></li></ul>';const o=n.querySelector(".page-item.active");n.querySelector(".page-item.first").page=1,n.querySelector(".page-item.last").page=-1,n.querySelectorAll(".page-item").forEach((t=>{t.onclick=()=>{t.classList.contains("active")||t.classList.contains("disabled")||this.onPaginationChange(this.pagination.rowNumber.value,t.page)}})),this.onPaginationChange&&(a.onchange=()=>{this.onPaginationChange(this.pagination.rowNumber.value,o.page)}),t.appendChild(n),this.table.parentNode.parentNode.insertBefore(t,this.table.parentNode.nextSibling),this.pagination={rowNumber:e.querySelector("select"),rowRecord:e.querySelector(".parent-row-record"),pagi:n}}setContent(t){this.datas=t,this.renderView()}setContentAndPagination(t){this.datas=t.result,this.setPagination(t.prePage,t.nextPage,t.result.length,t.totalRecords),this.renderView()}renderView(t=this.datas){for(let t in this.sumColumns)this.sumColumns.hasOwnProperty(t)&&(this.sumColumns[t]=0);if(this.beforeRender&&this.beforeRender(),setTimeout((()=>{this.render(t),this.afterRender&&this.afterRender()}),0),this.bottomDiv){const t=this.bottomDivFunction(this.sumColumns);"string"==typeof t?this.bottomDiv.innerHTML=t:t instanceof HTMLElement&&(this.bottomDiv.innerHTML="",this.bottomDiv.appendChild(t))}}setPagination(t,e,n,a){const{rowRecord:o,pagi:i}=this.pagination;a&&(o.classList.remove("d-none"),o.querySelector(".row-record").textContent=n,o.querySelector(".total-record").textContent=a);const s=i.querySelector(".page-item.active");s.page=t+1,s.querySelector("button").textContent=s.page;const r=i.querySelector(".first"),l=i.querySelector(".before"),d=i.querySelector(".after"),c=i.querySelector(".last"),h=s.previousElementSibling,p=s.nextElementSibling,u=(t,e,n)=>{t.page=e,t.classList.toggle("disabled",n),t.querySelector("svg")||(t.querySelector("button").textContent=e||""),t.querySelector("svg")||t.classList.toggle("d-none",!e)};u(l,t,0===t),u(r,1,0===t),u(h,t,0===t),u(d,e,0===e),u(c,-1,0===e),u(p,e,0===e)}clearContent(){this.datas=[],this.renderView()}refreshContent(){this.renderView()}destroy(){this.divTable.innerHTML="",delete this.divTable.tabletext}addData(t){this.datas.push(t),this.renderView()}removeData(t){this.datas.splice(t,1),this.renderView()}filterData(t){this.renderView(this.datas.filter(t))}}}();